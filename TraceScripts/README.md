# Instructions to capture trace logs for Azure PlayFab Lobby and Matchmaking (Multiplayer) SDK

Please follow the instructions below to capture trace logs generated by PlayFab Lobby and Matchmaking (Multiplayer) SDK integrated in your app. Once logs are collected, zip up the ETL file(s) (they compress very well) and send to us via customer support channel along with a description of the problem.

## PC (Win32 or GDK):
- Download the [`Trace-PlayFabMultiplayer.ps1` script](./Trace-PlayFabMultiplayer.ps1) from this repo
- Open an administrator command prompt or powershell session
    - the script is unsigned, so unless your powershell is setup to with an "Unrestricted" execution policy, you will have to pass that along as well.
- Run the `Trace-PlayFabMultiplayer.ps1` script. The script requires one parameter, which is a label to describe the trace attempt, and an optional parameter specifying verbosity. For example:
```
# A typical command used with normal verbosity for "try1"
powershell -ExecutionPolicy Unrestricted .\Trace-PlayFabMultiplayer.ps1 try1

# A more advanced command with increased verbosity for "try2"
powershell -ExecutionPolicy Unrestricted .\Trace-PlayFabMultiplayer.ps1 try2 -Verbosity Verbose
```
- Run your game and get into the state to reproduce the issue
- Hit enter in the command prompt to stop the trace. It will tell you the name of the generated `.etl` file which contains the trace.

## Xbox (GDK):
> [!NOTE]
> Replace "&lt;xboxip&gt;" with your Xbox console's IP address in the commands below:
- Open up a GDK developer prompt on your PC
- For each console involved in the issue, run the following command to start log collection:
```
xbtrace /x:<xboxip> start advancedmp
```
- Run your repro scenario which demonstrates the issue in PlayFab Lobby and Matchmaking (Multiplayer)
- For each console involved in the repro, run this command to finish log collection
```
xbtrace /x:<xboxip> stop
```

## iOS, macOS, and Android

The PlayFab Multiplayer C++ library for iOS, macOS, and Android includes logging capabilities with a configurable verbosity level. Logging configuration is defined in `PlayFabMultiplayerLogger.json` file which can be deployed alongside your application.

When this file is detected by the PFMultiplayer library at runtime within your application, it will use it to enable logging as configured. The following verbosity levels are currently supported:
1. `VERBOSE` - everything
2. `INFO` - less than everything, only important messages and errors
3. `ERROR` - only errors

The numeric values of the "logAreaFlags_ApiInOut", "logAreaFlags_FnInOut", and "logAreaFlags_Log" properties are internal and users should not need to alter them.

### iOS: Instructions

1. Download the [`PlayFabMultiplayerLogger.json` file](iOS/PlayFabMultiplayerLogger.json) from this repo.
2. Connect the iOS device to a Mac device.
3. Enable **FileSharing** for your application. This can be done through the **Info.plist** file of your application.
4. Open the finder application on a Mac, locate your connected iOS device section, and select it.
5. Click on the "Files" tab.
6. Locate the installed application that uses PlayFab Multiplayer.
7. Copy the `PlayFabMultiplayerLogger.json` file into this application's folder.
8. Run the application.
9. Locate the output log inside the directory specified by the `logFolder` property of `PlayFabMultiplayerLogger.json`.

### macOS: Instructions

1. Download the [`PlayFabMultiplayerLogger.json` file](macOS/PlayFabMultiplayerLogger.json) from this repo.
2. Enable **FileSharing** for your application, this can be done through the **Info.plist** file of your application.
3. Copy the `PlayFabMultiplayerLogger.json` file into the `~/Documents` directory.
4. Run the application.
5. Locate the output log inside the directory specified by the `logFolder` property of `PlayFabMultiplayerLogger.json`.

### Android: Instructions

> **Note: Gathering PlayFabMultiplayer Logs on Android only works for Android API 29 and below, due to Google's app-scoped storage permission changes for Android API 30 and beyond. This will be fixed in a future release.**

> *Note: Relevant documentation for copying files to and from Android devices can be found [here](https://developer.android.com/tools/adb#copyfiles).*

1. Download the [`PlayFabMultiplayerLogger.json` file](Android/PlayFabMultiplayerLogger.json) from this repo.
2. Connect the Android device to host machine running Android Studio/Android Debug Bridge (adb).
3. Enable USB Debugging on your Android device by following the ([Android USB Debugging documentation](https://developer.android.com/studio/debug/dev-options#Enable-debugging)).
4. Open a new terminal that has ADB. Double-check that your device is readable from ADB with 
```
$> adb devices -l
```
5. Create your `config` directory on the Android device.

    a. Please note that you need to create this directory before pushing the config file to your Android device due to ADB limitations.

    b. You'll also need to create the directories one level at a time due to ADB limitations.
```
$> adb shell mkdir /sdcard/PlayFabLogs/
$> adb shell mkdir /sdcard/PlayFabLogs/config/
```
6. Push the downloaded `PlayFabMultiplayerLogger.json` file to your Android device via
```
$> adb push <filepath>/PlayFabMultiplayerLogger.json /sdcard/PlayFabLogs/config/
```
7. Run the application. If using the default configuration of `PlayFabMultiplayerLogger.json`, logs should automatically be written to `/sdcard/PlayFabLogs/log/`. If not, logs will be written to the directory specified by the `logFolder` property of `PlayFabMultiplayerLogger.json`.
8. Once you've collected your logs, you can retrieve them from the device via ADB. The following ADB command will pull the entire `log/` directory from the Android device into the target directory on your computer.

    Please note that if you've modified the `logFolder` property of your `PlayFabMultiplayerLogger.json`, then you'll need to update the ADB command accordingly.
```
$> adb pull /sdcard/PlayFabLogs/log/ <target local directory>
```